{% extends "base.html" %}

{% block title %}Solicitar Registro - Sistema P√°tio{% endblock %}

{% block head %}
<!-- For√ßa reload do CSS - v3.0 -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registro-moderno.css') }}?v=3.0">
<!-- CSS externo aplicado via arquivo registro-moderno.css -->
        }
        
        .form-section {
            padding: 1rem;
        }
        
        .btn-group-registro {
            flex-direction: column;
        }
    }
    
    /* Anima√ß√µes */
    .registro-card {
        animation: slideInUp 0.6s ease-out;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* √çcones */
    .fas, .far {
        width: 1.2rem;
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="registro-container">
    <div class="card registro-card">
        <div class="card-header">
            <h1 class="registro-title">Solicitar Acesso</h1>
            <p class="registro-subtitle">Preencha o formul√°rio para solicitar cadastro no sistema</p>
        </div>
        
        <div class="card-body">
            <form method="POST" action="{{ url_for('auth.registro') }}" id="registroForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                <!-- Se√ß√£o: Dados Pessoais -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-user"></i>
                        Dados Pessoais
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="nome" class="form-label required">Nome Completo</label>
                                <input type="text" class="form-control" id="nome" name="nome" required 
                                       placeholder="Digite seu nome completo">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="email" class="form-label required">E-mail</label>
                                <input type="email" class="form-control" id="email" name="email" required 
                                       placeholder="seu.email@empresa.com">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Dados de Acesso -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-user-tag"></i>
                        Dados de Acesso
                    </h3>
                    
                    <div class="form-group">
                        <label for="username" class="form-label required">Nome de Usu√°rio Desejado</label>
                        <input type="text" class="form-control" id="username" name="username" required 
                               placeholder="Digite o nome de usu√°rio desejado">
                        <small class="form-text text-muted">Ser√° usado para fazer login no sistema</small>
                    </div>
                    
                    <!-- Informa√ß√£o sobre senha -->
                    <div class="alert alert-info" style="background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                        <h6 style="color: #1976d2; margin-bottom: 0.5rem;">
                            <i class="fas fa-info-circle"></i> 
                            Informa√ß√£o sobre Senha
                        </h6>
                        <p style="margin: 0; color: #424242; font-size: 0.9rem;">
                            Ap√≥s a aprova√ß√£o da sua solicita√ß√£o, voc√™ receber√° uma <strong>senha tempor√°ria</strong> por email. 
                            No primeiro acesso, ser√° solicitado que voc√™ defina uma nova senha segura.
                        </p>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Dados Organizacionais -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-building"></i>
                        Dados Organizacionais
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="unidade" class="form-label required">Unidade de Trabalho</label>
                                <select class="form-select" id="unidade" name="unidade" required>
                                    <option value="" selected disabled>Selecione sua unidade</option>
                                    {% for unidade in unidades %}
                                        <option value="{{ unidade }}">{{ unidade }}</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">Unidade onde voc√™ trabalhar√° no sistema</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="setor" class="form-label">Setor/Departamento</label>
                                <select class="form-select" id="setor" name="setor">
                                    <option value="" selected>Selecione seu setor (opcional)</option>
                                    <option value="Opera√ß√µes">Opera√ß√µes</option>
                                    <option value="Log√≠stica">Log√≠stica</option>
                                    <option value="Vistoria">Vistoria</option>
                                    <option value="Administrativo">Administrativo</option>
                                    <option value="TI">Tecnologia da Informa√ß√£o</option>
                                    <option value="Seguran√ßa">Seguran√ßa</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Outros">Outros</option>
                                </select>
                                <small class="form-text text-muted">Informa√ß√£o adicional para contexto da solicita√ß√£o</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Justificativa e Perfil de Acesso -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-user-shield"></i>
                        Perfil de Acesso Solicitado
                    </h3>
                    
                    <div class="form-group">
                        <label for="nivel_solicitado" class="form-label">Tipo de Acesso Necess√°rio</label>
                        <select class="form-select" id="nivel_solicitado" name="nivel_solicitado">
                            <option value="" selected disabled>Selecione o tipo de acesso</option>
                            <option value="operador">üë∑ Operador - Opera√ß√µes b√°sicas do p√°tio</option>
                            <option value="vistoriador">üîç Vistoriador - Inspe√ß√£o e vistoria de containers</option>
                            <option value="inventariante">üìã Inventariante - Controle de invent√°rio</option>
                            <option value="admin_operacional">‚öôÔ∏è Admin Operacional - Gest√£o operacional</option>
                            <option value="admin_administrativo">üìä Admin Administrativo - Relat√≥rios e hist√≥rico</option>
                        </select>
                        <small class="form-text text-muted">Selecione o n√≠vel de acesso mais adequado √†s suas fun√ß√µes</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="justificativa" class="form-label required">Justificativa Detalhada</label>
                        <textarea class="form-control" id="justificativa" name="justificativa" rows="4" required 
                                  placeholder="Descreva detalhadamente:
‚Ä¢ Por que precisa de acesso ao sistema?
‚Ä¢ Quais opera√ß√µes pretende realizar?
‚Ä¢ Como isso se relaciona com suas fun√ß√µes profissionais?
‚Ä¢ H√° algum prazo espec√≠fico para o acesso?"></textarea>
                        <small class="form-text text-muted">Forne√ßa informa√ß√µes detalhadas para agilizar a aprova√ß√£o</small>
                    </div>
                </div>
                
                <!-- Bot√µes -->
                <div class="btn-group-registro">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                        Enviar Solicita√ß√£o
                    </button>
                    <a href="{{ url_for('auth.login') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Voltar para Login
                    </a>
                </div>
            </form>
        </div>
        
        <div class="card-footer">
            <small>
                <i class="fas fa-info-circle"></i>
                Sua solicita√ß√£o ser√° analisada por um administrador. Voc√™ receber√° uma confirma√ß√£o por email quando sua conta for aprovada.
            </small>
        </div>
    </div>
</div>

<script>
// Valida√ß√£o em tempo real
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registroForm');
    
    // Valida√ß√£o de email
    const email = document.getElementById('email');
    email.addEventListener('input', function() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (this.value && emailRegex.test(this.value)) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else if (this.value) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
        }
    });
    
    // Valida√ß√£o de nome de usu√°rio
    const username = document.getElementById('username');
    username.addEventListener('input', function() {
        const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
        if (this.value && usernameRegex.test(this.value)) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else if (this.value) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
        }
    });
    
    // Valida√ß√£o de justificativa (m√≠nimo 20 caracteres)
    const justificativa = document.getElementById('justificativa');
    justificativa.addEventListener('input', function() {
        if (this.value.length >= 20) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else if (this.value.length > 0) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
        }
    });
    
    // Contador de caracteres para justificativa
    const charCounter = document.createElement('small');
    charCounter.className = 'form-text text-muted';
    charCounter.style.float = 'right';
    justificativa.parentNode.appendChild(charCounter);
    
    justificativa.addEventListener('input', function() {
        const count = this.value.length;
        charCounter.textContent = `${count} caracteres (m√≠nimo 20)`;
        charCounter.style.color = count >= 20 ? '#28a745' : '#6c757d';
    });
});
</script>
{% endblock %}
